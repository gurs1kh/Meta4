function Timer(){this.gameTime=0,this.maxStep=.05,this.wallLastTimestamp=0}function GameEngine(){this.entities=[],this.showOutlines=!1,this.ctx=null,this.click=null,this.mouse=null,this.wheel=null,this.surfaceWidth=null,this.surfaceHeight=null,this.KBeenHandled=!1}function Entity(t,i,e){this.game=t,this.x=i,this.y=e,this.removeFromWorld=!1}function AssetManager(){this.successCount=0,this.errorCount=0,this.cache=[],this.downloadQueue=[]}function Animation(t,i,e,n,a,o,s,h,r){this.spriteSheet=t,this.startX=i,this.startY=e,this.frameWidth=n,this.frameDuration=o,this.frameHeight=a,this.frames=s,this.totalTime=o*s,this.elapsedTime=0,this.loop=h,this.reverse=r}function PlayerInfo(t){Entity.call(this,t),this.heartSheet=ASSET_MANAGER.getAsset("img/heartspritesheet.png"),this.hearts=[new Animation(this.heartSheet,0,0,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,58,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,116,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,174,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,232,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,290,186,58,.2,1,!0,!1),new Animation(this.heartSheet,0,348,186,58,.2,1,!0,!1)],this.createButton=!0,this.minimap=new MiniMap(t)}function EnemyInfo(t,i,e){Entity.call(this,t),this.x=i,this.y=e,this.width=30,this.height=10,this.greenWidth=this.width}function Map(t){if(Entity.call(this,t,0,0),this.sheet=ASSET_MANAGER.getAsset("img/META4map.gif"),this.bounds={x1:335,y1:335,x2:6065,y2:6065},this.boundRects=[{x:2600,y:2600,width:490,height:280,rotation:Math.PI/4,bottom:!0,right:!0},{x:2600,y:3800,width:490,height:280,rotation:3*Math.PI/4,top:!0,right:!0},{x:3800,y:3800,width:490,height:280,rotation:5*Math.PI/4,top:!0,left:!0},{x:3800,y:2600,width:490,height:280,rotation:7*Math.PI/4,bottom:!0,left:!0},{x:3200,y:2380,width:1060,height:100,rotation:0,bottom:!0},{x:2380,y:3200,width:100,height:1060,rotation:0,right:!0},{x:4020,y:3200,width:100,height:1060,rotation:0,left:!0},{x:2925,y:4025,width:500,height:100,rotation:0,top:!0},{x:3475,y:4025,width:500,height:100,rotation:0,top:!0},{x:2800,y:2800,width:1090,height:100,rotation:Math.PI/4,top:!0,left:!0},{x:3600,y:2800,width:1090,height:100,rotation:7*Math.PI/4,top:!0,right:!0},{x:2760,y:3560,width:1090,height:100,rotation:3*Math.PI/4,bottom:!0,left:!0},{x:3640,y:3560,width:1090,height:100,rotation:5*Math.PI/4,bottom:!0,right:!0},{x:3150,y:3990,width:70,height:165,rotation:0,left:!0},{x:3250,y:3990,width:70,height:165,rotation:0,right:!0},{x:3180,y:4075,width:10,height:5,rotation:0,top:!0,left:!0},{x:3220,y:4075,width:10,height:5,rotation:0,top:!0,right:!0}],this.debug=!1,this.debug)for(var i=0;i<this.boundRects.length;i++)this.boundRects[i].color="rgb("+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+", "+Math.round(255*Math.random())+")"}function MiniMap(t){Entity.call(this,t,0,0),this.sheet=ASSET_MANAGER.getAsset("img/META4map-mini.gif")}function Camera(t,i,e){Entity.call(this,t,t.hero.x||0,t.hero.y||0),this.width=i,this.height=e}function PlaceEnemies(t,i){this.game=t,this.num=i,this.placeBasics(),this.placeHuman(),this.placeTomb(),this.placeUndead(),this.placeGoblin(),this.game.drDarkabolical=new DrDarkabolical(this.game,3200,3200),this.game.drDarkabolical.lifeMeter=new EnemyInfo(this.game,this.game.drDarkabolical.x,this.game.drDarkabolical.y-15),this.game.addEntity(this.game.drDarkabolical.lifeMeter),this.game.enemies.push(this.game.drDarkabolical),this.game.addEntity(this.game.drDarkabolical)}function getRandomNumber(t,i){return Math.floor(Math.random()*(i-t+1))+t}function PlaceTerrain(t,i){this.game=t,this.num=i,t.gate=new Gate(t,3170,4010),t.addEntity(t.gate),this.placeTrees(),this.placeSnowTrees(),this.placeTombs(),this.placeRocks(),this.placeTrap()}function Player(t,i,e,n,a,o){Entity.call(this,t,i,e),this.x=i,this.y=e,this.width=n,this.height=a,this.radius=o,this.animation,this.downAnimation,this.upAnimation,this.leftAnimation,this.rightAnimation,this.down=!1,this.up=!1,this.left=!1,this.right=!1}function Enemy(t,i,e,n,a){Player.call(this,t,i,e,n,a,200),this.speed=1,this.hitpoints=40,this.startingX=this.x,this.startingY=this.y,this.atStarting=!0,this.attackedTime=0}function getRandomNumber(t,i){return Math.floor(Math.random()*(i-t+1))+t}function Boss(t,i,e,n,a){Enemy.call(this,t,i,e,n,a),this.hitpoints=300,this.startingHitpoints=300}function Hero(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet5.png"),a=33.3,o=32;Player.call(this,t,i,e,a,o,200),this.animation=new Animation(n,94,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,94,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,94.5,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,94,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,94,192,a,o,.2,3,!0,!1),this.speed=3,this.lives=3,this.invincible=!1,this.timeBeingInvincible=0,this.num=0,this.weapons=[],this.weapons[0]=new Sword1(this.game,i,e,!0),this.weapons[1]=new Bow1(this.game,i,e,!0),this.currentWeapon=this.weapons[0],this.keys=[]}function collideCircleWithRotatedRectangle(t,i){var e,n,a=i.x,o=i.y,s=a-i.width/2,h=o-i.height/2,r=s,m=h,c=Math.cos(i.rotation)*(t.x-a)-Math.sin(i.rotation)*(t.y-o)+a,l=Math.sin(i.rotation)*(t.x-a)+Math.cos(i.rotation)*(t.y-o)+o;e=r>c?r:c>r+i.width?r+i.width:c,n=m>l?m:l>m+i.height?m+i.height:l;var p=!1,g=getDistance({x:c,y:l},{x:e,y:n});return p=g<t.radius}function getDistance(t,i){var e=Math.abs(t.x-i.x),n=Math.abs(t.y-i.y);return Math.sqrt(e*e+n*n)}function DrDarkabolical(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet5.png"),a=33.3,o=32;Boss.call(this,t,i,e,a,o),this.radius=250,this.speed=2,this.animation=new Animation(n,224,128,32,32,.05,1,!0,!1),this.upAnimation=new Animation(n,192,224,32,32,.2,3,!0,!1),this.downAnimation=new Animation(n,192,128,32,32,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,160,32,32,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,192,32,32,.2,3,!0,!1),this.telOutAnimation=new Animation(n,288,128,32,32,.05,9,!1,!0),this.telInAnimation=new Animation(n,288,128,32,32,.05,9,!1,!1),this.telIn=!1,this.telOut=!1,this.currentRound=0,this.minionsAlive=0,this.vulnerable=!1,this.dead=!1,this.attackingTime=0,this.attackDelay=2e3}function placeDark(t){for(;;)for(var i=[getlocationDark(2500,3200,2500,3200,1),getlocationDark(3200,3900,2500,3200,2),getlocationDark(2500,3200,3200,3800,3),getlocationDark(3200,3900,3200,3800,4)],e=0;4>e;e++){var n,a=getRandomNumber(0,1);if(n=a?new Hood(this.game,i[e].x,i[e].y):new Scarf(this.game,i[e].x,i[e].y),this.game.enemies.push(n),this.game.addEntity(n),this.game.drDarkabolical.minionsAlive++,this.game.drDarkabolical.minionsAlive===t)return}}function getlocationDark(t,i,e,n,a){for(var o={},s=!0;;){switch(s&&(o={x:getRandomNumber(t,i),y:getRandomNumber(e,n)}),s=!1,a){case 1:o.x+o.y>=5700&&o.x+o.y<=6400||(s=!0);break;case 2:o.x-o.y>=0&&o.x-o.y<=700||(s=!0);break;case 3:o.x-o.y>=-700&&o.x-o.y<=0||(s=!0);break;case 4:o.x+o.y>=6400&&o.x+o.y<=7100||(s=!0)}if(!s)for(var h=0;h<this.game.enemies.length;h++)getDistance(this.game.enemies[h],o)<=100&&(s=!0);if(!s)break}return o}function ArmoredGoblin(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet3.png"),a=33.3,o=32;Boss.call(this,t,i,e,a,o),this.animation=new Animation(n,94,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,94,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,94.5,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,94,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,94,192,a,o,.2,3,!0,!1)}function BlackKnight(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet7.png"),a=32,o=32;Boss.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,64,a,o,.2,3,!0,!1)}function BlackRat(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,96,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,96,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,96,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,96,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,96,64,a,o,.2,3,!0,!1),this.hitpoints=20}function BlondeZombie(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,192,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,192,a,o,.2,3,!0,!1),this.hitpoints=40}function BrownRat(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,64,a,o,.2,3,!0,!1),this.hitpoints=20}function Death(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Boss.call(this,t,i,e,a,o,200),this.animation=new Animation(n,288,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,288,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,288,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,288,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,288,64,a,o,.2,3,!0,!1)}function Dog(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet2.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,192,a,o,.2,3,!0,!1),this.hitpoints=40}function Eyepatch(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet4.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,192,a,o,.2,3,!0,!1),this.hitpoints=70}function HelmetGoblin(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet3.png"),a=33,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,192,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,64,a,o,.2,3,!0,!1),this.hitpoints=40}function Hood(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet4.png"),a=32.3,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,287,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,287,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,287,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,287,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,287,64,a,o,.2,3,!0,!1),this.hitpoints=100}function Mummy(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet3.png"),a=33.3,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,192,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,192,a,o,.2,3,!0,!1),this.hitpoints=80}function Scarf(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet4.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,192,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,64,a,o,.2,3,!0,!1),this.hitpoints=150}function Skeleton(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet2.png"),a=33.3,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,190,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,190,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,190,192,a,o,.2,3,!0,!1),this.hitpoints=50,this.attackingTime=0,this.attackDelay=3e3}function SkeletonKing(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Boss.call(this,t,i,e,a,o,200),this.animation=new Animation(n,192,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,192,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,192,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,192,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,192,64,a,o,.2,3,!0,!1)}function Stitches(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet2.png"),a=31,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,290,0,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,290,0,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,290,96,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,290,32,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,290,64,a,o,.2,3,!0,!1),this.hitpoints=40,this.attackingTime=0,this.attackDelay=3e3}function SuburbanZombie(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,288,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,288,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,288,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,288,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,288,192,a,o,.2,3,!0,!1),this.hitpoints=40}function SuitZombie(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,96,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,96,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,96,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,96,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,96,192,a,o,.2,3,!0,!1),this.hitpoints=40}function Viking(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet6.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,192,a,o,.2,3,!0,!1),this.hitpoints=100}function WizardGoblin(t,i,e){var n=ASSET_MANAGER.getAsset("img/sheet3.png"),a=32,o=32;Enemy.call(this,t,i,e,a,o,200),this.animation=new Animation(n,0,128,a,o,.02,1,!0,!1),this.downAnimation=new Animation(n,0,128,a,o,.2,3,!0,!1),this.upAnimation=new Animation(n,0,224,a,o,.2,3,!0,!1),this.leftAnimation=new Animation(n,0,160,a,o,.2,3,!0,!1),this.rightAnimation=new Animation(n,0,192,a,o,.2,3,!0,!1),this.hitpoints=70,this.attackingTime=0,this.attackDelay=3e3}function Item(t,i,e){Entity.call(this,t,i,e),this.pickedUp=!1}function Weapon(t,i,e,n){Entity.call(this,t,i,e),this.attacking=!1,this.attackingTime=0,this.pickedUp=n}function Sword(t,i,e,n){Weapon.call(this,t,i,e,n),this.attackDelay=5e3,this.width=28,this.height=25,this.offX=15,this.offY=5}function Sword1(t,i,e,n){Sword.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/weaponsheet2.png");this.animation=new Animation(a,68,132,20,25,.2,1,!0,!1),this.damage=30,this.offX=10}function Sword2(t,i,e,n){Sword.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/weaponsheet2.png");this.animation=new Animation(a,0,163,28,25,.2,1,!0,!1),this.damage=55}function Sword3(t,i,e,n){Sword.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/weaponsheet2.png");this.animation=new Animation(a,33,163,28,25,.2,1,!0,!1),this.damage=70}function Bow(t,i,e,n){Weapon.call(this,t,i,e,n),this.attackDelay=2e3,this.width=25,this.height=25,this.offX=10,this.offY=0}function Bow1(t,i,e,n){Bow.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/bows.png");this.animation=new Animation(a,1,2,13,33,.2,1,!0,!1),this.damage=15}function Bow2(t,i,e,n){Bow.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/bows.png");this.animation=new Animation(a,36,0,16,36,.2,1,!0,!1),this.damage=25}function Bow3(t,i,e,n){Bow.call(this,t,i,e,n);var a=ASSET_MANAGER.getAsset("img/bows.png");this.animation=new Animation(a,72,3,15,32,.2,1,!0,!1),this.damage=35}function Arrow(t,i,e,n,a){Entity.call(this,t,i,e);var o=ASSET_MANAGER.getAsset("img/arrow.png");this.animations=[new Animation(o,0,4,32,11,.2,1,!0,!1),new Animation(o,38,0,11,29,.2,1,!0,!1),new Animation(o,71,10,32,11,.2,1,!0,!1),new Animation(o,53,0,11,29,.2,1,!0,!1)],this.damage=n,this.dir=a,a%2?(this.width=32,this.height=11):(this.width=11,this.height=29)}function BlueOrb(t,i,e,n,a){Entity.call(this,t,i,e);var o=ASSET_MANAGER.getAsset("img/projectiles.png");this.animation=new Animation(o,438,192,21,21,.2,1,!0,!1),this.width=21,this.height=21,this.deltaX=n,this.deltaY=a}function Bone(t,i,e,n,a){Entity.call(this,t,i,e);var o=ASSET_MANAGER.getAsset("img/throwingBone.gif");this.animation=new Animation(o,0,0,18,17,.2,4,!0,!1),this.width=18,this.height=17,this.deltaX=n,this.deltaY=a}function PurpleOrb(t,i,e,n,a){Entity.call(this,t,i,e);var o=ASSET_MANAGER.getAsset("img/purpleOrb.png");this.animation=new Animation(o,0,0,23,24,.2,1,!0,!1),this.width=23,this.height=24,this.deltaX=n,this.deltaY=a}function NinjaStar(t,i,e,n,a){Entity.call(this,t,i,e);var o=ASSET_MANAGER.getAsset("img/ninjaStars.png");this.animation=new Animation(o,0,0,12,12,.2,2,!0,!1),this.width=12,this.height=12,this.deltaX=n,this.deltaY=a}function Key(t,i,e,n){Entity.call(this,t,i,e),this.x=i,this.y=e,this.width=25,this.height=25,this.sheet=ASSET_MANAGER.getAsset("img/keys.png"),this.animations=[new Animation(this.sheet,0,0,20,21,.2,1,!0,!1),new Animation(this.sheet,20,0,24,24,.2,1,!0,!1),new Animation(this.sheet,44,0,21,20,.2,1,!0,!1),new Animation(this.sheet,65,0,22,24,.2,1,!0,!1)],this.whichKey=n,this.pickedUp=!1}function Terrain(t,i,e){Entity.call(this,t,i,e)}function getRandomNumber(t,i){return Math.floor(Math.random()*(i-t+1))+t}function Gate(t,i,e){Terrain.call(this,t,i,e),this.width=61,this.height=64,this.sheet=ASSET_MANAGER.getAsset("img/gate.png"),this.gateClosed=new Animation(this.sheet,0,0,61,64,.2,1,!0,!1),this.gateOpening1=new Animation(this.sheet,0,63,61,64,.2,1,!0,!1),this.gateOpening2=new Animation(this.sheet,0,127,61,64,.2,1,!0,!1),this.gateOpening3=new Animation(this.sheet,0,191,61,64,.2,1,!0,!1),this.gateOpen=new Animation(this.sheet,0,254,61,64,.2,1,!0,!1),this.closed=!0,this.whichGate=1,t.map.boundRects.push({x:this.x+this.width/2,y:this.y+this.height/2,rotation:0,width:this.width,height:this.height,top:!0,gate:!0})}function Tree(t,i,e){Terrain.call(this,t,i,e),this.width=95,this.height=95,this.sheet=ASSET_MANAGER.getAsset("img/sheetTree.png");var n=getRandomNumber(0,15);0===n?this.animation=new Animation(this.sheet,0,0,95,95,.2,1,!0,!1):1===n?this.animation=new Animation(this.sheet,95,0,95,95,.2,1,!0,!1):2===n?this.animation=new Animation(this.sheet,190,0,95,95,.2,1,!0,!1):3===n?this.animation=new Animation(this.sheet,285,0,95,95,.2,1,!0,!1):4===n?this.animation=new Animation(this.sheet,0,95,95,95,.2,1,!0,!1):5===n?this.animation=new Animation(this.sheet,95,95,95,95,.2,1,!0,!1):6===n?this.animation=new Animation(this.sheet,190,95,95,95,.2,1,!0,!1):7===n?this.animation=new Animation(this.sheet,285,95,95,95,.2,1,!0,!1):8===n?this.animation=new Animation(this.sheet,0,190,95,95,.2,1,!0,!1):9===n?this.animation=new Animation(this.sheet,95,190,95,95,.2,1,!0,!1):10===n?this.animation=new Animation(this.sheet,190,190,95,95,.2,1,!0,!1):11===n?this.animation=new Animation(this.sheet,285,190,95,95,.2,1,!0,!1):12===n?this.animation=new Animation(this.sheet,0,285,95,95,.2,1,!0,!1):13===n?this.animation=new Animation(this.sheet,95,285,95,95,.2,1,!0,!1):14===n?this.animation=new Animation(this.sheet,190,285,95,95,.2,1,!0,!1):15===n&&(this.animation=new Animation(this.sheet,285,285,95,95,.2,1,!0,!1)),this.addBoundRects(this.x+3*this.width/8,this.y+3*this.height/4,this.width/4,this.height/4)}function SnowTree(t,i,e){Terrain.call(this,t,i,e),this.width=95,this.height=95,this.sheet=ASSET_MANAGER.getAsset("img/sheetSnowTree.png");var n=getRandomNumber(0,15);0===n?this.animation=new Animation(this.sheet,0,0,95,95,.2,1,!0,!1):1===n?this.animation=new Animation(this.sheet,95,0,95,95,.2,1,!0,!1):2===n?this.animation=new Animation(this.sheet,190,0,95,95,.2,1,!0,!1):3===n?this.animation=new Animation(this.sheet,285,0,95,95,.2,1,!0,!1):4===n?this.animation=new Animation(this.sheet,0,95,95,95,.2,1,!0,!1):5===n?this.animation=new Animation(this.sheet,95,95,95,95,.2,1,!0,!1):6===n?this.animation=new Animation(this.sheet,190,95,95,95,.2,1,!0,!1):7===n?this.animation=new Animation(this.sheet,285,95,95,95,.2,1,!0,!1):8===n?this.animation=new Animation(this.sheet,0,190,95,95,.2,1,!0,!1):9===n?this.animation=new Animation(this.sheet,95,190,95,95,.2,1,!0,!1):10===n?this.animation=new Animation(this.sheet,190,190,95,95,.2,1,!0,!1):11===n?this.animation=new Animation(this.sheet,285,190,95,95,.2,1,!0,!1):12===n?this.animation=new Animation(this.sheet,0,285,95,95,.2,1,!0,!1):13===n?this.animation=new Animation(this.sheet,95,285,95,95,.2,1,!0,!1):14===n?this.animation=new Animation(this.sheet,190,285,95,95,.2,1,!0,!1):15===n&&(this.animation=new Animation(this.sheet,285,285,95,95,.2,1,!0,!1)),this.addBoundRects(this.x+3*this.width/8,this.y+3*this.height/4,this.width/4,this.height/4)}function Tombstone(t,i,e){Terrain.call(this,t,i,e),this.width=50,this.height=38,this.sheet=ASSET_MANAGER.getAsset("img/sheetTombstone.png");var n=getRandomNumber(0,1);0===n?this.animation=new Animation(this.sheet,0,20,56,58,.2,1,!0,!1):1===n&&(this.animation=new Animation(this.sheet,56,20,49,58,.2,1,!0,!1)),this.addBoundRects(this.x,this.y,this.width,this.height)}function Rock(t,i,e){Terrain.call(this,t,i,e),this.width=35,this.height=35,this.sheet=ASSET_MANAGER.getAsset("img/sheetRock.png"),this.animation=new Animation(this.sheet,52,8,33,36,.2,1,!0,!1),this.addBoundRects(this.x,this.y,this.width,this.height)}function FlatTerrain(t,i,e){Terrain.call(this,t,i,e),this.width=41.5,this.height=43}function Pit(t,i,e){FlatTerrain.call(this,t,i,e),this.sheet=ASSET_MANAGER.getAsset("img/sheetPit.png"),this.animation=new Animation(this.sheet,584,0,83,86,.2,1,!0,!1)}function FalseFloor(t,i,e){FlatTerrain.call(this,t,i,e)}function FalseFloorZombie(t,i,e){FalseFloor.call(this,t,i,e),this.sheet=ASSET_MANAGER.getAsset("img/sheetPit.png"),this.animation=new Animation(this.sheet,386,0,93,95,.2,1,!0,!1)}function FalseFloorSnow(t,i,e){FalseFloor.call(this,t,i,e),this.sheet=ASSET_MANAGER.getAsset("img/sheetPit.png"),this.animation=new Animation(this.sheet,97,102,100,99,.2,1,!0,!1)}function FalseFloorTomb(t,i,e){FalseFloor.call(this,t,i,e),this.sheet=ASSET_MANAGER.getAsset("img/sheetPit.png"),this.animation=new Animation(this.sheet,289,0,95,96,.2,1,!0,!1)}function FalseFloorHuman(t,i,e){FalseFloor.call(this,t,i,e),this.sheet=ASSET_MANAGER.getAsset("img/sheetPit.png"),this.animation=new Animation(this.sheet,98,0,95,95,.2,1,!0,!1)}function Heart(t,i,e){Entity.call(this,t,i,e),this.x=i,this.y=e,this.width=15.5,this.height=14.5,this.sheet=ASSET_MANAGER.getAsset("img/heartspritesheet.png"),this.animation=new Animation(this.sheet,0,58,62,58,.2,1,!0,!1),this.pickedUp=!1}function newGame(){var t=document.getElementById("gameWorld"),i=t.getContext("2d");game=new GameEngine;var e=[],n=[];game.map=new Map(game),game.hero=new Hero(game,3180,4100),game.camera=new Camera(game,t.width,t.height),game.playerInfo=new PlayerInfo(game),game.enemies=e,game.terrain=n,game.addEntity(game.camera),game.addEntity(game.hero),game.bossesKilled=0,new PlaceEnemies(game,30),new PlaceTerrain(game,30),game.init(i),game.start()}window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){window.setTimeout(t,1e3/60)}}(),Timer.prototype.tick=function(){var t=Date.now(),i=(t-this.wallLastTimestamp)/1e3;this.wallLastTimestamp=t;var e=Math.min(i,this.maxStep);return this.gameTime+=e,e},GameEngine.prototype.init=function(t){this.ctx=t,this.surfaceWidth=this.ctx.canvas.width,this.surfaceHeight=this.ctx.canvas.height,this.startInput(),this.timer=new Timer},GameEngine.prototype.start=function(){var t=this;!function i(){t.loop(),requestAnimationFrame(i,t.ctx.canvas)}()},GameEngine.prototype.startInput=function(){var t=this;this.ctx.canvas.addEventListener("keydown",function(i){"A"===String.fromCharCode(i.which)&&(t.a=!0),"W"===String.fromCharCode(i.which)&&(t.w=!0),"S"===String.fromCharCode(i.which)&&(t.s=!0),"D"===String.fromCharCode(i.which)&&(t.d=!0)," "===String.fromCharCode(i.which)&&(t.j=!0,i.preventDefault()),i.keyCode>=37&&i.keyCode<=40&&i.preventDefault()},!1),this.ctx.canvas.addEventListener("keyup",function(i){"A"===String.fromCharCode(i.which)&&(t.a=!1),"W"===String.fromCharCode(i.which)&&(t.w=!1),"S"===String.fromCharCode(i.which)&&(t.s=!1),"D"===String.fromCharCode(i.which)&&(t.d=!1)," "===String.fromCharCode(i.which)&&(t.j=!1),37===i.keyCode&&(t.left=!0),38===i.keyCode&&(t.up=!0),39===i.keyCode&&(t.right=!0),40===i.keyCode&&(t.down=!0)},!1)},GameEngine.prototype.addEntity=function(t){this.entities.push(t)},GameEngine.prototype.draw=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save();var t=-(this.camera.x-this.camera.width/2),i=-(this.camera.y-this.camera.height/2);this.ctx.translate(t,i),this.map.draw(this.ctx);for(var e=0;e<this.entities.length;e++)this.entities[e]&&(this.camera.onScreen(this.entities[e])||this.entities[e]instanceof Map||this.entities[e]instanceof PlayerInfo)&&this.entities[e].draw(this.ctx);this.playerInfo.draw(this.ctx),this.ctx.restore()},GameEngine.prototype.update=function(){for(var t=this.entities.length,i=0;t>i;i++){var e=this.entities[i];e&&!e.removeFromWorld&&e.update()}this.entities.sort(function(t,i){return t instanceof FlatTerrain?-1:i instanceof FlatTerrain?1:t.y+t.height-(i.y+i.height)});for(var i=this.entities.length-1;i>=0;--i)this.entities[i]&&!this.entities[i].removeFromWorld||(this.entities[i]instanceof Enemy&&this.entities[i].update(),this.entities.splice(i,1));this.playerInfo.update()},GameEngine.prototype.loop=function(){this.clockTick=this.timer.tick(),this.update(),this.draw(),this.space=null},Entity.prototype.update=function(){},Entity.prototype.draw=function(t){this.game.showOutlines&&this.radius&&(t.strokeStyle="red",t.strokeRect(this.x,this.y,this.width,this.height),t.beginPath(),t.strokeStyle="green",t.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),t.stroke(),t.closePath())},Entity.prototype.collide=function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y},Entity.prototype.rotateAndCache=function(t,i){var e=document.createElement("canvas"),n=Math.max(t.width,t.height);e.width=n,e.height=n;var a=e.getContext("2d");return a.save(),a.translate(n/2,n/2),a.rotate(i),a.translate(0,0),a.drawImage(t,-(t.width/2),-(t.height/2)),a.restore(),e},AssetManager.prototype.queueDownload=function(t){this.downloadQueue.push(t)},AssetManager.prototype.isDone=function(){return this.downloadQueue.length===this.successCount+this.errorCount},AssetManager.prototype.downloadAll=function(t){for(var i=0;i<this.downloadQueue.length;i++){var e=new Image,n=this,a=this.downloadQueue[i];e.addEventListener("load",function(){n.successCount++,n.isDone()&&t()}),e.addEventListener("error",function(){n.errorCount++,n.isDone()&&t()}),e.src=a,this.cache[a]=e}},AssetManager.prototype.getAsset=function(t){return this.cache[t]},Animation.prototype.drawFrame=function(t,i,e,n,a){var a=a||1;if(this.elapsedTime+=t,this.loop)this.isDone()&&(this.elapsedTime=0);else if(this.isDone())return;for(var o=this.reverse?this.frames-this.currentFrame()-1:this.currentFrame(),s=0;(o+1)*this.frameWidth+this.startX>this.spriteSheet.width;)o-=Math.floor((this.spriteSheet.width-this.startX)/this.frameWidth),s++;var h=e,r=n;i.drawImage(this.spriteSheet,o*this.frameWidth+this.startX,s*this.frameHeight+this.startY,this.frameWidth,this.frameHeight,h,r,this.frameWidth*a,this.frameHeight*a)},Animation.prototype.currentFrame=function(){return Math.floor(this.elapsedTime/this.frameDuration)},Animation.prototype.isDone=function(){return this.elapsedTime>=this.totalTime},PlayerInfo.prototype=new Entity,PlayerInfo.prototype.constructor=PlayerInfo,PlayerInfo.prototype.update=function(){this.game.hero.lives<=0&&(this.game.hero.lives=-(1/0),this.game.entities.forEach(function(t){t&&(t.removeFromWorld=!0)}))},PlayerInfo.prototype.draw=function(t){t.save(),t.setTransform(1,0,0,1,0,0);var i=this.game.camera;if(this.game.hero.lives<=0){var e=ASSET_MANAGER.getAsset("img/game-over-screen.png");t.drawImage(e,0,0,i.width,i.height),this.createButton&&(document.getElementById("resetButton").style.display="inline",this.createButton=!1)}else if(this.game.drDarkabolical.dead){var e=ASSET_MANAGER.getAsset("img/win-screen.png");t.drawImage(e,0,0,i.width,i.height),this.createButton&&(document.getElementById("resetButton").style.display="inline",this.createButton=!1)}else this.game.hero.currentWeapon.animation.drawFrame(this.game.clockTick,t,i.width-30,40),this.hearts[2*this.game.hero.lives].drawFrame(this.game.clockTick,t,i.width-100,5,.5),this.game.hero.keys.forEach(function(e){if(e.pickedUp){var n=e.whichKey;e.animations[n].drawFrame(e.game.clockTick,t,i.width-25,40*(n+2))}}),this.minimap.draw(t);t.restore()},EnemyInfo.prototype=new Entity,EnemyInfo.prototype.constructor=EnemyInfo,EnemyInfo.prototype.draw=function(t){t.fillStyle="red",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="green",t.fillRect(this.x,this.y,this.greenWidth,this.height),Entity.prototype.draw.call(this)},Map.prototype=new Entity,Map.prototype.constructor=Map,Map.prototype.draw=function(t){if(t.drawImage(this.sheet,0,0,6400,6400,0,0,6400,6400),this.debug)for(var i=0;i<this.boundRects.length;i++){var e=this.boundRects[i];t.save(),t.translate(e.x,e.y),t.fillStyle=e.color,t.rotate(-e.rotation),t.fillRect(-e.width/2,-e.height/2,e.width,e.height),t.restore()}},MiniMap.prototype=new Entity,MiniMap.prototype.constructor=MiniMap,MiniMap.prototype.draw=function(t){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=.7;var i=5;t.drawImage(this.sheet,0,0,200,200,i,i,100,100),t.fillStyle="red",t.beginPath();var e=i+(this.game.hero.x+this.game.hero.width/2-this.game.map.bounds.x1)/5730*100,n=i+(this.game.hero.y+this.game.hero.height-this.game.map.bounds.y1)/5730*100;t.arc(e,n,3,0,2*Math.PI),t.fill(),t.fillStyle="white";for(var a=game.enemies.filter(function(t){return t instanceof Boss&&!(t instanceof DrDarkabolical)}),o=0;o<a.length;o++){var s=a[o];t.beginPath();var e=i+(s.x+s.width/2-this.game.map.bounds.x1)/5730*100,n=i+(s.y+s.height-this.game.map.bounds.y1)/5730*100;t.arc(e,n,2,0,2*Math.PI),t.fill()}t.restore()},Camera.prototype=new Entity,Camera.prototype.constructor=Camera,Camera.prototype.update=function(){this.x=this.game.hero.x+this.game.hero.width/2,this.y=this.game.hero.y+this.game.hero.height/2},Camera.prototype.getBounds=function(){return{x1:this.x-this.width/2,x2:this.x+this.width/2,y1:this.y-this.height/2,y2:this.y+this.height/2}},Camera.prototype.onScreen=function(t){return bounds=this.getBounds(),t.x+t.width>bounds.x1&&t.x<bounds.x2&&t.y+t.width>bounds.y1&&t.y<bounds.y2},PlaceEnemies.prototype=new Entity,PlaceEnemies.prototype.constructor=PlaceEnemies,PlaceEnemies.prototype.placeBasics=function(){this.placeBasicsAtlocation(1950,4450,4500,6050),this.placeBasicsAtlocation(1950,4450,350,2300),this.placeBasicsAtlocation(350,2300,1950,4450),this.placeBasicsAtlocation(4100,6050,1950,4450)},PlaceEnemies.prototype.placeBasicsAtlocation=function(t,i,e,n){for(var a=0;a<this.num;a++){var o,s=this.getlocation(t,i,e,n),h=getRandomNumber(0,2);
0===h?o=new Dog(this.game,s.x,s.y):1===h?o=new BlackRat(this.game,s.x,s.y):2===h&&(o=new BrownRat(this.game,s.x,s.y)),this.game.enemies.push(o),this.game.addEntity(o)}},PlaceEnemies.prototype.placeHuman=function(){var t=new BlackKnight(this.game,500,500);t.lifeMeter=new EnemyInfo(t.game,t.x,t.y-15),this.game.addEntity(t.lifeMeter),this.game.enemies.push(t),this.game.addEntity(t);for(var i=0;i<this.num;i++){var e,n=this.getlocation(400,1900,350,1910),a=getRandomNumber(0,2);0===a?e=new Stitches(this.game,n.x,n.y):1===a?e=new Eyepatch(this.game,n.x,n.y):2===a&&(e=new Viking(this.game,n.x,n.y)),this.game.enemies.push(e),this.game.addEntity(e)}},PlaceEnemies.prototype.placeTomb=function(){var t=new SkeletonKing(this.game,500,5900);t.lifeMeter=new EnemyInfo(t.game,t.x,t.y-15),this.game.addEntity(t.lifeMeter),this.game.enemies.push(t),this.game.addEntity(t);for(var i=0;i<this.num;i++){var e,n=this.getlocation(400,1900,4475,6040),a=getRandomNumber(0,1);e=a?new Mummy(this.game,n.x,n.y):new Skeleton(this.game,n.x,n.y),this.game.enemies.push(e),this.game.addEntity(e)}},PlaceEnemies.prototype.placeUndead=function(){var t=new Death(this.game,5820,500);t.lifeMeter=new EnemyInfo(t.game,t.x,t.y-15),this.game.addEntity(t.lifeMeter),this.game.enemies.push(t),this.game.addEntity(t);for(var i=0;i<this.num;i++){var e,n=this.getlocation(4475,6040,350,1910),a=getRandomNumber(0,2);0===a?e=new SuitZombie(this.game,n.x,n.y):1===a?e=new BlondeZombie(this.game,n.x,n.y):2===a&&(e=new SuburbanZombie(this.game,n.x,n.y)),this.game.enemies.push(e),this.game.addEntity(e)}},PlaceEnemies.prototype.placeGoblin=function(){var t=new ArmoredGoblin(this.game,5820,5900);t.lifeMeter=new EnemyInfo(t.game,t.x,t.y-15),this.game.addEntity(t.lifeMeter),this.game.enemies.push(t),this.game.addEntity(t);for(var i=0;i<this.num;i++){var e,n=this.getlocation(4475,6040,4475,6040),a=getRandomNumber(0,1);e=a?new HelmetGoblin(this.game,n.x,n.y):new WizardGoblin(this.game,n.x,n.y),this.game.enemies.push(e),this.game.addEntity(e)}},PlaceEnemies.prototype.getlocation=function(t,i,e,n){for(var a={},o=!0;o;){o=!1,a={x:getRandomNumber(t,i),y:getRandomNumber(e,n)};for(var s=0;s<this.game.terrain.length;s++)getDistance(this.game.terrain[s],a)<=500&&(o=!0,s=this.game.terrain.length)}return a},PlaceTerrain.prototype=new Entity,PlaceTerrain.prototype.constructor=PlaceTerrain,PlaceTerrain.prototype.placeTrees=function(){this.placeTreesAtlocation(1950,4150,4300,5900),this.placeTreesAtlocation(1950,4150,550,2050),this.placeTreesAtlocation(550,2e3,1950,4300),this.placeTreesAtlocation(4400,5900,1950,4150)},PlaceTerrain.prototype.placeTreesAtlocation=function(t,i,e,n){for(var a=0;a<this.num;a++){var o,s=this.getlocation(t,i,e,n);o=new Tree(this.game,s.x,s.y),this.game.terrain.push(o),this.game.addEntity(o)}},PlaceTerrain.prototype.placeTombs=function(){for(var t=0;t<this.num;t++){var i,e=this.getlocation(400,1400,4475,5540),n=getRandomNumber(0,1);i=0===n?new Tombstone(this.game,e.x,e.y):new FalseFloorTomb(this.game,e.x,e.y),this.game.terrain.push(i),this.game.addEntity(i)}},PlaceTerrain.prototype.placeSnowTrees=function(){for(var t=0;t<this.num;t++){var i,e=this.getlocation(4975,5640,4675,5640),n=getRandomNumber(0,1);i=0===n?new SnowTree(this.game,e.x,e.y):new FalseFloorSnow(this.game,e.x,e.y),this.game.terrain.push(i),this.game.addEntity(i)}},PlaceTerrain.prototype.placeRocks=function(){for(var t=0;t<this.num;t++){var i,e=this.getlocation(400,1500,350,1510),n=getRandomNumber(0,1);i=0===n?new Rock(this.game,e.x,e.y):new FalseFloorHuman(this.game,e.x,e.y),this.game.terrain.push(i),this.game.addEntity(i)}},PlaceTerrain.prototype.placeTrap=function(){for(var t=0;t<this.num;t++){var i,e=this.getlocation(4775,5840,350,1510);i=new FalseFloorZombie(this.game,e.x,e.y),this.game.terrain.push(i),this.game.addEntity(i)}},PlaceTerrain.prototype.getlocation=function(t,i,e,n){for(var a={},o=!0;o;){o=!1,a={x:getRandomNumber(t,i),y:getRandomNumber(e,n)};for(var s=0;s<this.game.terrain.length;s++)getDistance(this.game.terrain[s],a)<=100&&(o=!0,s=this.game.terrain.length)}return a},Player.prototype=new Entity,Player.prototype.constructor=Player,Player.prototype.canSee=function(t){var i=t.x,e=t.x+t.width,n=t.y,a=t.y+t.height,o=this.x+this.width/2,s=this.y+this.height/2,h=Math.sqrt((i-o)*(i-o)+(n-s)*(n-s)),r=Math.sqrt((e-o)*(e-o)+(n-s)*(n-s)),m=Math.sqrt((i-o)*(i-o)+(a-s)*(a-s)),c=Math.sqrt((e-o)*(e-o)+(a-s)*(a-s));return h<this.radius||r<this.radius||m<this.radius||c<this.radius},Player.prototype.draw=function(t){this.invincible&&this.num%10!==0||(this.down?this.downAnimation.drawFrame(this.game.clockTick,t,this.x,this.y,1):this.up?this.upAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.left?this.leftAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.right?this.rightAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)),Entity.prototype.draw.call(this)},Enemy.prototype=new Player,Enemy.prototype.constructor=Enemy,Enemy.prototype.update=function(){if(this.removeFromWorld){var t=getRandomNumber(0,9);4===t&&this.game.addEntity(new Heart(this.game,this.x,this.y))}this.down=!1,this.up=!1,this.left=!1,this.right=!1;var i={x:-this.x,y:-this.y};this.canSee(this.game.hero)?(i.x+=this.game.hero.x,i.y+=this.game.hero.y):(i.x+=this.startingX,i.y+=this.startingY);var e=Math.sqrt(i.x*i.x+i.y*i.y);e&&(i.x*=this.speed/e,i.y*=this.speed/e),0==i.x&&0==i.y||(Math.abs(i.x)>.75*Math.abs(i.y)?i.x>0?this.right=!0:this.left=!0:i.y<0?this.up=!0:this.down=!0),this.attackedTime>0&&(this.attackedTime-=100,i.x*=-4,i.y*=-4),i.x=Math.round(i.x),i.y=Math.round(i.y),this.x+=i.x,this.y+=i.y,Player.prototype.update.call(this)},Boss.prototype=new Enemy,Boss.prototype.constructor=Boss,Boss.prototype.update=function(){if(Enemy.prototype.update.call(this),this instanceof DrDarkabolical?this.lifeMeter.greenWidth=this.lifeMeter.width-(this.game.drDarkabolical.currentRound-1)*(this.lifeMeter.width/3):this.lifeMeter.greenWidth=this.hitpoints/this.startingHitpoints*this.lifeMeter.width,this.lifeMeter.x=this.x,this.lifeMeter.y=this.y-15,this.removeFromWorld){this.lifeMeter.removeFromWorld=!0;var t=new Key(this.game,this.x,this.y,this.game.hero.keys.length);this.game.addEntity(t),this.game.bossesKilled++;var i;switch(this.game.bossesKilled){case 1:i=new Sword2(this.game,this.x+25,this.y);break;case 2:i=new Bow2(this.game,this.x+25,this.y);break;case 3:i=new Sword3(this.game,this.x+25,this.y);break;case 4:i=new Bow3(this.game,this.x+25,this.y)}this.game.addEntity(i)}Entity.prototype.update.call(this)},Hero.prototype=new Player,Hero.prototype.constructor=Hero,Hero.prototype.pickUp=function(t){t instanceof Sword?this.currentWeapon=this.weapons[0]=t:t instanceof Bow?this.currentWeapon=this.weapons[1]=t:t instanceof Key?this.keys.push(t):t instanceof Heart&&this.lives<=2.5&&(this.lives+=.5)},Hero.prototype.update=function(){var t={x:0,y:0};this.invincible&&(this.timeBeingInvincible<1e3?(this.timeBeingInvincible+=20,this.num++):(this.invincible=!1,this.timeBeingInvincible=0,this.speed*=.75)),this.game.j&&(this.currentWeapon=this.weapons[(this.weapons.indexOf(this.currentWeapon)+1)%2],this.game.j=!1),this.game.a?(this.left=!0,t.x-=this.speed):this.left=!1,this.game.w?(this.up=!0,t.y-=this.speed):this.up=!1,this.game.s?(this.down=!0,t.y+=this.speed):this.down=!1,this.game.d?(this.right=!0,t.x+=this.speed):this.right=!1;var i=this.game.left||this.game.right||this.game.up||this.game.down;i&&this.currentWeapon.attackingTime<=0?(this.currentWeapon.attacking=!0,this.currentWeapon.attackingTime=this.currentWeapon.attackDelay,this.currentWeapon.up=this.game.up,this.currentWeapon.down=this.game.down,this.currentWeapon.left=this.game.left,this.currentWeapon.right=this.game.right,this.game.up=!1,this.game.down=!1,this.game.left=!1,this.game.right=!1):this.currentWeapon.attackingTime<=0?(this.currentWeapon.attacking=!1,this.currentWeapon.up=!1,this.currentWeapon.down=!1,this.currentWeapon.left=!1,this.currentWeapon.right=!1):this.currentWeapon.attackingTime-=100,this.x+=t.x,this.y+=t.y;var e=this.game.map.bounds,n=this.x+this.width/2,a=this.y+this.height;n<e.x1&&(n=e.x1),a<e.y1&&(a=e.y1),n>e.x2&&(n=e.x2),a>e.y2&&(a=e.y2),this.x=n-this.width/2,this.y=a-this.height;for(var o=0;o<this.game.map.boundRects.length;o++){var s=this.game.map.boundRects[o];if(s.all&&collideCircleWithRotatedRectangle({x:this.x+this.width/2,y:this.y+this.height,radius:5},s))this.x-=t.x,this.y-=t.y;else for(;collideCircleWithRotatedRectangle({x:this.x+this.width/2,y:this.y+this.height,radius:5},s);)s.top&&this.y++,s.bottom&&this.y--,s.left&&this.x++,s.right&&this.x--}for(var o=0;o<this.game.enemies.length;o++){var h=this.game.enemies[o];this.invincible||h.removeFromWorld||!this.collide(h)||(this.lives-=.5,this.invincible=!0,this.speed*=4/3,this.num++,this.lives<=0&&(this.removeFromWorld=!0,h.x!==h.startingX&&h.y!==h.startingY&&(h.walkTowardX=h.startingX,h.walkTowardY=h.startingY,h.atStarting=!1)))}var r=this;this.game.entities.filter(function(t){return t instanceof Pit&&t.collide(r)}).length>0&&(this.invincible||this.lives--,this.invincible=!0),Player.prototype.update.call(this),this.currentWeapon.update()},Hero.prototype.draw=function(t){if((this.currentWeapon.up||this.currentWeapon.left)&&this.currentWeapon instanceof Sword&&(this.upAnimation.elapsedTime=0,this.leftAnimation.elapsedTime=0,this.currentWeapon.draw(t)),!this.invincible||this.num%10===0)if(this.currentWeapon instanceof Bow)Player.prototype.draw.call(this,t);else{var i=this.currentWeapon.attackingTime>=this.currentWeapon.attackDelay/2;this.down||this.currentWeapon.down&&i?this.downAnimation.drawFrame(this.game.clockTick,t,this.x,this.y,1):this.up||this.currentWeapon.up&&i?this.upAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.left||this.currentWeapon.left&&i?this.leftAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.right||this.currentWeapon.right&&i?this.rightAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)}Entity.prototype.draw.call(this),(this.currentWeapon.down||this.currentWeapon.right)&&this.currentWeapon instanceof Sword&&(this.downAnimation.elapsedTime=0,this.rightAnimation.elapsedTime=0,this.currentWeapon.draw(t)),this.currentWeapon instanceof Bow&&this.currentWeapon.draw(t)},DrDarkabolical.prototype=new Boss,DrDarkabolical.prototype.constructor=DrDarkabolical,DrDarkabolical.prototype.update=function(){if(this.dead)this.removeFromWorld=!0;else{if(Boss.prototype.update.call(this),this.canSee(this.game.hero)&&this.vulnerable&&this.attackingTime<=0){this.attackingTime=this.attackDelay;var t={x:-this.x,y:-this.y};t.x+=this.game.hero.x,t.y+=this.game.hero.y;var i=Math.sqrt(t.x*t.x+t.y*t.y);i&&(t.x*=5/i,t.y*=5/i),t.x=Math.round(t.x),t.y=Math.round(t.y);var e=new PurpleOrb(this.game,this.x,this.y,t.x,t.y);this.game.addEntity(e)}else this.attackingTime>0&&(this.attackingTime-=50);this.canSee(this.game.hero)&&!this.vulnerable&&(this.telOut=!0),0===this.minionsAlive&&this.canSee(this.game.hero)&&!this.vulnerable&&(this.currentRound++,this.telOut=!0,placeDark(3+2*this.currentRound)),this.telOut?this.telOutAnimation.isDone()&&(this.telOutAnimation.elapsedTime=0,this.telOut=!1,this.telIn=!0,this.x+=getRandomNumber(-250,250),this.y+=getRandomNumber(-250,250)):this.telIn&&this.telInAnimation.isDone()&&(this.telInAnimation.elapsedTime=0,this.telIn=!1)}},DrDarkabolical.prototype.draw=function(t){this.telOut?this.telOutAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.telIn?this.telInAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.up?this.upAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.down?this.downAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.left?this.leftAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.right?this.rightAnimation.drawFrame(this.game.clockTick,t,this.x,this.y):this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)},ArmoredGoblin.prototype=new Boss,ArmoredGoblin.prototype.constructor=ArmoredGoblin,BlackKnight.prototype=new Boss,BlackKnight.prototype.constructor=BlackKnight,BlackRat.prototype=new Enemy,BlackRat.prototype.constructor=BlackRat,BlondeZombie.prototype=new Enemy,BlondeZombie.prototype.constructor=BlondeZombie,BrownRat.prototype=new Enemy,BrownRat.prototype.constructor=BrownRat,Death.prototype=new Boss,Death.prototype.constructor=Death,Dog.prototype=new Enemy,Dog.prototype.constructor=Dog,Eyepatch.prototype=new Enemy,Eyepatch.prototype.constructor=Eyepatch,HelmetGoblin.prototype=new Enemy,HelmetGoblin.prototype.constructor=HelmetGoblin,Hood.prototype=new Enemy,Hood.prototype.constructor=Hood,Mummy.prototype=new Enemy,Mummy.prototype.constructor=Mummy,Scarf.prototype=new Enemy,Scarf.prototype.constructor=Scarf,Skeleton.prototype=new Enemy,Skeleton.prototype.constructor=Skeleton,Skeleton.prototype.update=function(){if(Enemy.prototype.update.call(this),this.canSee(this.game.hero)&&this.attackingTime<=0){this.attackingTime=this.attackDelay;var t={x:-this.x,y:-this.y};t.x+=this.game.hero.x,t.y+=this.game.hero.y;var i=Math.sqrt(t.x*t.x+t.y*t.y);i&&(t.x*=2/i,t.y*=2/i),t.x=Math.round(t.x),t.y=Math.round(t.y);var e=new Bone(this.game,this.x,this.y,t.x,t.y);this.game.addEntity(e)}else this.attackingTime>0&&(this.attackingTime-=50);Entity.prototype.update.call(this)},SkeletonKing.prototype=new Boss,SkeletonKing.prototype.constructor=SkeletonKing,Stitches.prototype=new Enemy,Stitches.prototype.constructor=Stitches,Stitches.prototype.update=function(){if(Enemy.prototype.update.call(this),this.canSee(this.game.hero)&&this.attackingTime<=0){this.attackingTime=this.attackDelay;var t={x:-this.x,y:-this.y};t.x+=this.game.hero.x,t.y+=this.game.hero.y;var i=Math.sqrt(t.x*t.x+t.y*t.y);i&&(t.x*=2/i,t.y*=2/i),t.x=Math.round(t.x),t.y=Math.round(t.y);var e=new NinjaStar(this.game,this.x,this.y,t.x,t.y);this.game.addEntity(e)}else this.attackingTime>0&&(this.attackingTime-=50);Entity.prototype.update.call(this)},SuburbanZombie.prototype=new Enemy,SuburbanZombie.prototype.constructor=SuburbanZombie,SuitZombie.prototype=new Enemy,SuitZombie.prototype.constructor=SuitZombie,Viking.prototype=new Enemy,Viking.prototype.constructor=Viking,WizardGoblin.prototype=new Enemy,WizardGoblin.prototype.constructor=WizardGoblin,WizardGoblin.prototype.update=function(){if(Enemy.prototype.update.call(this),this.canSee(this.game.hero)&&this.attackingTime<=0){this.attackingTime=this.attackDelay;var t={x:-this.x,y:-this.y};t.x+=this.game.hero.x,t.y+=this.game.hero.y;var i=Math.sqrt(t.x*t.x+t.y*t.y);i&&(t.x*=2/i,t.y*=2/i),t.x=Math.round(t.x),t.y=Math.round(t.y);var e=new BlueOrb(this.game,this.x,this.y,t.x,t.y);this.game.addEntity(e)}else this.attackingTime>0&&(this.attackingTime-=50);Entity.prototype.update.call(this)},Item.prototype=new Entity,Item.prototype.constructor=Item,Item.prototype.update=function(){this.flipped=this.game.d,!this.pickedUp&&this.collide(this.game.hero)&&(this.pickedUp=!0,this.game.hero.pickUp(this),this.removeFromWorld=!0),Entity.prototype.update.call(this)},Item.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)},Weapon.prototype=new Item,Weapon.prototype.constructor=Weapon,Weapon.prototype.update=function(){Item.prototype.update.call(this),this.pickedUp&&(this.x=this.game.hero.x,this.y=this.game.hero.y)},Weapon.prototype.draw=function(t){this.pickedUp?(this.attacking||this instanceof Bow)&&this.animation.drawFrame(this.game.clockTick,t,this.game.hero.x-this.width,this.game.hero.y):this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)},Sword.prototype=new Weapon,Sword.prototype.constructor=Sword,Sword.prototype.update=function(){if(Weapon.prototype.update.call(this),this.pickedUp&&(this.left?(this.x-=this.offX,this.y+=this.offY):this.right?(this.x+=this.offX,this.y+=this.offY):this.up?this.y-=this.offY:this.down&&(this.y+=this.game.hero.height/2+this.offY)),this.attacking&&this.pickedUp&&this.attackingTime>=this.attackDelay/2)for(var t=0;t<this.game.enemies.length;t++){var i=this.game.enemies[t];this.collide(i)&&(i instanceof DrDarkabolical?(this.game.drDarkabolical.vulnerable&&3===this.game.drDarkabolical.currentRound&&(this.game.drDarkabolical.dead=!0),this.game.drDarkabolical.vulnerable&&(this.game.drDarkabolical.vulnerable=!1)):(i.hitpoints-=this.damage,i.attackedTime=1e3,i.hitpoints<=0&&((i instanceof Scarf||i instanceof Hood)&&(this.game.drDarkabolical.minionsAlive--,0===this.game.drDarkabolical.minionsAlive&&(this.game.drDarkabolical.vulnerable=!0)),this.game.enemies.splice(t,1),t--,i.removeFromWorld=!0)))}},Weapon.prototype.draw=function(t){if(t.save(),this.pickedUp){if(this.attacking&&this.attackingTime>=this.attackDelay/2||this instanceof Bow){t.translate(this.game.camera.x,this.game.camera.y+5);var i=0,e=0;this.up&&(e=-5,i=18,t.scale(1,1)),this.down&&(e=0,i=18,t.scale(-1,-1)),this.left&&(i=5,e=10,t.scale(1,1)),this.right&&(i=5,e=10,t.scale(-1,1)),this.animation.drawFrame(this.game.clockTick,t,-this.width+i,-this.height+e)}}else this.animation.drawFrame(this.game.clockTick,t,this.x,this.y);t.restore()},Sword1.prototype=new Sword,Sword1.prototype.constructor=Sword1,Sword2.prototype=new Sword,Sword2.prototype.constructor=Sword2,Sword3.prototype=new Sword,Sword3.prototype.constructor=Sword3,Bow.prototype=new Weapon,Bow.prototype.constructor=Bow,Bow.prototype.update=function(){Weapon.prototype.update.call(this),this.attackingTime<=0&&this.pickedUp&&(this.left?this.game.addEntity(new Arrow(this.game,this.x,this.y,this.damage,0)):this.down?this.game.addEntity(new Arrow(this.game,this.x,this.y,this.damage,1)):this.right?this.game.addEntity(new Arrow(this.game,this.x,this.y,this.damage,2)):this.up&&this.game.addEntity(new Arrow(this.game,this.x,this.y,this.damage,3)))},Bow.prototype.draw=function(t){this.pickedUp?(this.attacking||this instanceof Bow)&&this.flipped?(t.save(),t.scale(-1,1),this.animation.drawFrame(this.game.clockTick,t,-this.x-this.width-this.offX,this.y),t.restore()):(this.attacking||this instanceof Bow)&&this.animation.drawFrame(this.game.clockTick,t,this.x,this.y):this.animation.drawFrame(this.game.clockTick,t,this.x,this.y)},Bow1.prototype=new Bow,Bow1.prototype.constructor=Bow1,Bow2.prototype=new Bow,Bow2.prototype.constructor=Bow2,Bow3.prototype=new Bow,Bow3.prototype.constructor=Bow3,Arrow.prototype=new Entity,Arrow.prototype.constructor=Arrow,Arrow.prototype.update=function(){this.game.camera.getBounds();this.game.camera.onScreen(this)&&!this.collide(this.game.gate)||(this.removeFromWorld=!0);for(var t=0;t<this.game.enemies.length;t++){var i=this.game.enemies[t];this.collide(i)&&(i instanceof DrDarkabolical?(this.game.drDarkabolical.vulnerable&&3===this.game.drDarkabolical.currentRound&&(this.game.drDarkabolical.dead=!0),this.game.drDarkabolical.vulnerable&&(this.game.drDarkabolical.vulnerable=!1)):(i.radius=300,i.hitpoints-=this.damage,i.hitpoints<=0&&((i instanceof Scarf||i instanceof Hood)&&(this.game.drDarkabolical.minionsAlive--,0===this.game.drDarkabolical.minionsAlive&&(this.game.drDarkabolical.vulnerable=!0)),this.game.enemies.splice(t,1),t--,i.removeFromWorld=!0),this.removeFromWorld=!0))}0==this.dir?this.x-=6:1==this.dir?this.y+=6:2==this.dir?this.x+=6:3==this.dir&&(this.y-=6),Entity.prototype.update.call(this)},Arrow.prototype.draw=function(t){this.animations[this.dir].drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},BlueOrb.prototype=new Entity,BlueOrb.prototype.constructor=BlueOrb,BlueOrb.prototype.update=function(){this.game.camera.onScreen(this)&&!this.collide(this.game.gate)||(this.removeFromWorld=!0),this.collide(this.game.hero)&&!this.game.hero.invincible&&(this.game.hero.lives-=.5,this.game.hero.invincible=!0,this.game.hero.speed*=4/3,this.game.hero.num++,this.removeFromWorld=!0,this.game.hero.lives<=0&&(this.game.hero.removeFromWorld=!0)),this.x+=this.deltaX,this.y+=this.deltaY,Entity.prototype.update.call(this)},BlueOrb.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},Bone.prototype=new Entity,Bone.prototype.constructor=Bone,Bone.prototype.update=function(){this.game.camera.onScreen(this)&&!this.collide(this.game.gate)||(this.removeFromWorld=!0),this.collide(this.game.hero)&&!this.game.hero.invincible&&(this.game.hero.lives-=.5,this.game.hero.invincible=!0,this.game.hero.speed*=4/3,this.game.hero.num++,this.removeFromWorld=!0,this.game.hero.lives<=0&&(this.game.hero.removeFromWorld=!0)),this.x+=this.deltaX,this.y+=this.deltaY,Entity.prototype.update.call(this)},Bone.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},PurpleOrb.prototype=new Entity,PurpleOrb.prototype.constructor=PurpleOrb,PurpleOrb.prototype.update=function(){this.game.camera.onScreen(this)&&!this.collide(this.game.gate)||(this.removeFromWorld=!0),this.collide(this.game.hero)&&!this.game.hero.invincible&&(this.game.hero.lives-=.5,this.game.hero.invincible=!0,this.game.hero.speed*=4/3,this.game.hero.num++,this.removeFromWorld=!0,this.game.hero.lives<=0&&(this.game.hero.removeFromWorld=!0)),this.x+=this.deltaX,this.y+=this.deltaY,Entity.prototype.update.call(this)},PurpleOrb.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},NinjaStar.prototype=new Entity,NinjaStar.prototype.constructor=NinjaStar,NinjaStar.prototype.update=function(){this.game.camera.onScreen(this)&&!this.collide(this.game.gate)||(this.removeFromWorld=!0),this.collide(this.game.hero)&&!this.game.hero.invincible&&(this.game.hero.lives-=.5,this.game.hero.invincible=!0,this.game.hero.speed*=4/3,this.game.hero.num++,this.removeFromWorld=!0,this.game.hero.lives<=0&&(this.game.hero.removeFromWorld=!0)),this.x+=this.deltaX,this.y+=this.deltaY,Entity.prototype.update.call(this)},NinjaStar.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},Key.prototype=new Entity,Key.prototype.constructor=Key,Key.prototype.update=function(){Item.prototype.update.call(this),this.pickedUp&&(this.x=this.game.camera.width-20,this.y=40*this.whichKey)},Key.prototype.draw=function(t){this.animations[this.whichKey].drawFrame(this.game.clockTick,t,this.x,this.y),Entity.prototype.draw.call(this)},Terrain.prototype=new Entity,Terrain.prototype.constructor=Terrain,Terrain.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y,1),Entity.prototype.draw.call(this)},Terrain.prototype.addBoundRects=function(t,i,e,n){this.game.map.boundRects.push({x:t+e/6,y:i+n/6,rotation:0,width:e/3,height:n/3,bottom:!0,right:!0}),this.game.map.boundRects.push({x:t+e/6*3,y:i+n/6,rotation:0,width:e/3,height:n/3,bottom:!0}),this.game.map.boundRects.push({x:t+e/6*5,y:i+n/6,rotation:0,width:e/3,height:n/3,bottom:!0,left:!0}),this.game.map.boundRects.push({x:t+e/6,y:i+n/6*3,rotation:0,width:e/3,height:n/3,right:!0}),this.game.map.boundRects.push({x:t+e/6*5,y:i+n/6*3,rotation:0,width:e/3,height:n/3,left:!0}),this.game.map.boundRects.push({x:t+e/6,y:i+n/6*5,rotation:0,width:e/3,height:n/3,top:!0,right:!0}),this.game.map.boundRects.push({x:t+e/6*3,y:i+n/6*5,rotation:0,width:e/3,height:n/3,top:!0}),this.game.map.boundRects.push({x:t+e/6*5,y:i+n/6*5,rotation:0,width:e/3,height:n/3,top:!0,left:!0})},Gate.prototype=new Terrain,Gate.prototype.constructor=Gate,Gate.prototype.update=function(){this.collide(this.game.hero)&&(0==this.game.hero.keys.length?this.whichGate=1:1==this.game.hero.keys.length?this.whichGate=2:2==this.game.hero.keys.length?this.whichGate=3:3==this.game.hero.keys.length?this.whichGate=4:4==this.game.hero.keys.length&&(this.whichGate=5,this.closed&&(this.game.map.boundRects=this.game.map.boundRects.filter(function(t){return!t.gate})),this.closed=!1)),Terrain.prototype.update.call(this)},Gate.prototype.draw=function(t){1==this.whichGate?this.gateClosed.drawFrame(this.game.clockTick,t,this.x,this.y):2==this.whichGate?this.gateOpening1.drawFrame(this.game.clockTick,t,this.x,this.y):3==this.whichGate?this.gateOpening2.drawFrame(this.game.clockTick,t,this.x,this.y):4==this.whichGate?this.gateOpening3.drawFrame(this.game.clockTick,t,this.x,this.y):5==this.whichGate&&this.gateOpen.drawFrame(this.game.clockTick,t,this.x,this.y)},Tree.prototype=new Terrain,Tree.prototype.constructor=Tree,SnowTree.prototype=new Terrain,SnowTree.prototype.constructor=SnowTree,Tombstone.prototype=new Terrain,Tombstone.prototype.constructor=Tombstone,Rock.prototype=new Terrain,Rock.prototype.constructor=Rock,FlatTerrain.prototype=new Terrain,FlatTerrain.prototype.constructor=FlatTerrain,FlatTerrain.prototype.collide=function(t){var i=this.x+7*this.width/16,e=this.y+7*this.width/16,n=this.width/4,a=this.height/4,o=t.x+t.width/2-n/2,s=t.y+t.height-a/2;return o+n>i&&i+n>o&&s+a>e&&a+e>s},Pit.prototype=new FlatTerrain,Pit.prototype.constructor=Pit,Pit.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y,.5)},FalseFloor.prototype=new FlatTerrain,FalseFloor.prototype.constructor=FalseFloor,FalseFloor.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y,.5)},FalseFloorZombie.prototype=new FalseFloor,FalseFloorZombie.prototype.constructor=FalseFloorZombie,FalseFloorZombie.prototype.update=function(){this.collide(this.game.hero)&&(this.removeFromWorld=!0,this.game.entities.push(new Pit(this.game,this.x,this.y)))},FalseFloorSnow.prototype=new FalseFloor,FalseFloorSnow.prototype.constructor=FalseFloorSnow,FalseFloorTomb.prototype=new FalseFloor,FalseFloorTomb.prototype.constructor=FalseFloorTomb,FalseFloorHuman.prototype=new FalseFloor,FalseFloorHuman.prototype.constructor=FalseFloorHuman,Heart.prototype=new Item,Heart.prototype.constructor=Heart,Heart.prototype.draw=function(t){this.animation.drawFrame(this.game.clockTick,t,this.x,this.y,.25),Entity.prototype.draw.call(this)},window.onload=function(){ASSET_MANAGER=new AssetManager,ASSET_MANAGER.queueDownload("img/sheet2.png"),ASSET_MANAGER.queueDownload("img/sheet3.png"),ASSET_MANAGER.queueDownload("img/sheet4.png"),ASSET_MANAGER.queueDownload("img/sheet5.png"),ASSET_MANAGER.queueDownload("img/sheet6.png"),ASSET_MANAGER.queueDownload("img/sheet7.png"),ASSET_MANAGER.queueDownload("img/META4map.gif"),ASSET_MANAGER.queueDownload("img/META4map-mini.gif"),ASSET_MANAGER.queueDownload("img/weaponsheet2.png"),ASSET_MANAGER.queueDownload("img/arrow.png"),ASSET_MANAGER.queueDownload("img/bows.png"),ASSET_MANAGER.queueDownload("img/keys.png"),ASSET_MANAGER.queueDownload("img/gate.png"),ASSET_MANAGER.queueDownload("img/heartspritesheet.png"),ASSET_MANAGER.queueDownload("img/startscreen.png"),ASSET_MANAGER.queueDownload("img/game-over-screen.png"),ASSET_MANAGER.queueDownload("img/win-screen.png"),ASSET_MANAGER.queueDownload("img/sheetTree.png"),ASSET_MANAGER.queueDownload("img/sheetSnowTree.png"),ASSET_MANAGER.queueDownload("img/sheetTombstone.png"),ASSET_MANAGER.queueDownload("img/sheetRock.png"),ASSET_MANAGER.queueDownload("img/sheetPit.png"),ASSET_MANAGER.queueDownload("img/projectiles.png"),ASSET_MANAGER.queueDownload("img/throwingBone.gif"),ASSET_MANAGER.queueDownload("img/purpleOrb.png"),ASSET_MANAGER.queueDownload("img/ninjaStars.png"),ASSET_MANAGER.downloadAll(function(){newGame();var t=new Audio("audio/meta4-theme.wav");t.loop=!0,t.play()})};